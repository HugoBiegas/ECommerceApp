@* Books/Details.cshtml *@
@model Book
@{
    ViewData["Title"] = Model.Title;
}

<div class="row">
    <!-- Image et Infos principales -->
    <div class="col-lg-4">
        <div class="card">
            <img src="@(!string.IsNullOrEmpty(Model.ImageUrl) ? Model.ImageUrl : "/images/book-placeholder.jpg")"
                 class="card-img-top" alt="@Model.Title" style="height: 400px; object-fit: cover;" />
            <div class="card-body text-center">
                <stock-indicator stock="@Model.Stock" is-available="@Model.IsAvailable"></stock-indicator>

                @if (ViewBag.IsLoggedIn == true && Model.InStock)
                {
                    <form method="post" asp-controller="Books" asp-action="AddToCart" class="mt-3">
                        <input type="hidden" name="bookId" value="@Model.Id" />
                        <div class="input-group mb-3">
                            <input type="number" name="quantity" value="1" min="1" max="@Model.Stock" class="form-control text-center" />
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-shopping-cart me-2"></i>Ajouter au panier
                            </button>
                        </div>
                    </form>
                }
                else if (ViewBag.IsLoggedIn != true)
                {
                    <a asp-controller="Account" asp-action="Login" class="btn btn-outline-primary mt-3">
                        <i class="fas fa-sign-in-alt me-2"></i>Connectez-vous pour acheter
                    </a>
                }
            </div>
        </div>
    </div>

    <!-- Détails du livre -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h1 class="card-title">@Model.Title</h1>
                        <p class="h5 text-muted mb-3">par @(Model.Author?.Name ?? "Auteur inconnu")</p>
                    </div>
                    <div class="text-end">
                        <price-display price="@Model.Price" size="large"></price-display>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6><i class="fas fa-tag me-2"></i>Catégorie</h6>
                        <category-badge category="@Model.Category"></category-badge>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-calendar me-2"></i>Date de publication</h6>
                        <p class="text-muted">@(Model.PublicationDate?.ToString("dd MMMM yyyy") ?? "Non spécifiée")</p>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.ISBN))
                {
                    <div class="mb-3">
                        <h6><i class="fas fa-barcode me-2"></i>ISBN</h6>
                        <code>@Model.ISBN</code>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <div class="mb-4">
                        <h6><i class="fas fa-align-left me-2"></i>Description</h6>
                        <p class="text-muted">@Model.Description</p>
                    </div>
                }

                <!-- Actions Admin/Libraire -->
                <div asp-role="@UserRole.Librarian">
                    <hr />
                    <div class="d-flex gap-2">
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-primary">
                            <i class="fas fa-edit me-2"></i>Modifier
                        </a>
                        <confirm-delete item-name="ce livre"
                                        delete-url="/Books/Delete/@Model.Id"
                                        button-class="btn btn-outline-danger"
                                        modal-id="deleteBookModal">
                        </confirm-delete>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Livres du même auteur -->
<div class="row mt-5">
    <div class="col-12">
        <h3><i class="fas fa-user-edit me-2"></i>Autres livres de @(Model.Author?.Name ?? "cet auteur")</h3>
        <hr />
        <!-- Ici on afficherait d'autres livres du même auteur -->
        <p class="text-muted">Section à implémenter avec d'autres livres du même auteur.</p>
    </div>
</div>
