@* Books/Details.cshtml - CORRECTED VERSION *@
@model Book
@{
    ViewData["Title"] = Model.Title;
}

<div class="row">
    <!-- Image et Infos principales -->
    <div class="col-lg-4">
        <div class="card">
            <img src="@(!string.IsNullOrEmpty(Model.ImageUrl) ? Model.ImageUrl : "/images/book-placeholder.jpg")"
                 class="card-img-top" alt="@Model.Title" style="height: 400px; object-fit: cover;" />
            <div class="card-body text-center">
                <stock-indicator stock="@Model.Stock" is-available="@Model.IsAvailable"></stock-indicator>

                @if (ViewBag.IsLoggedIn == true && Model.InStock)
                {
                    <!-- CORRECTION: Utiliser un bouton avec classe CSS au lieu d'un formulaire POST -->
                    <div class="mt-3">
                        <div class="input-group mb-3">
                            <input type="number" name="quantity" value="1" min="1" max="@Model.Stock"
                                   class="form-control text-center" id="quantity-@Model.Id" />
                            <button type="button" class="btn btn-primary add-to-cart-btn"
                                    data-book-id="@Model.Id">
                                <i class="fas fa-shopping-cart me-2"></i>Ajouter au panier
                            </button>
                        </div>
                    </div>
                }
                else if (ViewBag.IsLoggedIn != true)
                {
                    <a asp-controller="Account" asp-action="Login" class="btn btn-outline-primary mt-3">
                        <i class="fas fa-sign-in-alt me-2"></i>Connectez-vous pour acheter
                    </a>
                }
            </div>
        </div>
    </div>

    <!-- Détails du livre -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h1 class="card-title">@Model.Title</h1>
                        <p class="h5 text-muted mb-3">par @(Model.Author?.Name ?? "Auteur inconnu")</p>
                    </div>
                    <div class="text-end">
                        <price-display price="@Model.Price" size="large"></price-display>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6><i class="fas fa-tag me-2"></i>Catégorie</h6>
                        <category-badge category="@Model.Category"></category-badge>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-calendar me-2"></i>Date de publication</h6>
                        <p class="text-muted">@(Model.PublicationDate?.ToString("dd MMMM yyyy") ?? "Non spécifiée")</p>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <div class="mb-4">
                        <h6><i class="fas fa-align-left me-2"></i>Description</h6>
                        <p class="text-justify">@Model.Description</p>
                    </div>
                }

                @if (ViewBag.CanManageBooks == true)
                {
                    <div class="mt-4 pt-3 border-top">
                        <h6><i class="fas fa-cogs me-2"></i>Actions de gestion</h6>
                        <div class="btn-group">
                            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-warning">
                                <i class="fas fa-edit me-1"></i>Modifier
                            </a>
                            <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-outline-danger">
                                <i class="fas fa-trash me-1"></i>Supprimer
                            </a>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Script spécifique pour la page Details si nécessaire
        document.addEventListener('DOMContentLoaded', function() {
            // Le JavaScript principal dans site.js gère déjà les boutons add-to-cart-btn
            console.log('Books Details page loaded - AJAX cart functionality active');
        });
    </script>
}